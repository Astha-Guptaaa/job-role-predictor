<!-- window.onload = async () => {
    const token = localStorage.getItem("token");
    const googleUser = JSON.parse(localStorage.getItem("googleUser") || "null");

    if (!token) {
        window.location.href = "login.html";
        return;
    }

    try {
        const res = await fetch("http://127.0.0.1:5000/profile", {
            method: "GET",
            headers: { "Authorization": "Bearer " + token }
        });

        const result = await res.json();

        if (!res.ok) {
            alert(result.error || "Failed to load profile");
            localStorage.clear();
            window.location.href = "login.html";
            return;
        }

        const user = result.user;

        document.getElementById("user_name").textContent =
            user.username || user.email;

        document.getElementById("name").textContent = user.username || "-";
        document.getElementById("email").textContent = user.email || "-";
        document.getElementById("degree").textContent = user.degree || "-";
        document.getElementById("specialization").textContent = user.specialization || "-";
        document.getElementById("cgpa").textContent = user.cgpa || "-";
        document.getElementById("certifications").textContent =
            user.certifications || "-";

        if (googleUser?.picture) {
            const img = document.getElementById("profile_pic");
            img.src = googleUser.picture;
            img.style.display = "block";
        }

        // ‚úÖ LOAD HISTORY ONLY ONCE
        loadPredictionHistory();

    } catch {
        alert("Backend not running");
    }
};


// =======================
// EDIT PROFILE in dashboard.js
// =======================
document.getElementById("editBtn").onclick = () => {
    document.getElementById("editForm").style.display = "block";

    document.getElementById("edit_name").value =
        document.getElementById("name").innerText;
    document.getElementById("edit_degree").value =
        document.getElementById("degree").innerText === "-" ? "" : document.getElementById("degree").innerText;
    document.getElementById("edit_specialization").value =
        document.getElementById("specialization").innerText === "-" ? "" : document.getElementById("specialization").innerText;
    document.getElementById("edit_cgpa").value =
        document.getElementById("cgpa").innerText === "-" ? "" : document.getElementById("cgpa").innerText;
    document.getElementById("edit_certifications").value =
        document.getElementById("certifications").innerText === "-" ? "" : document.getElementById("certifications").innerText;
};

document.getElementById("saveBtn").onclick = async () => {
    const token = localStorage.getItem("token");
    const msg = document.getElementById("update_msg");

    const body = {
        username: document.getElementById("edit_name").value.trim(),
        degree: document.getElementById("edit_degree").value.trim(),
        specialization: document.getElementById("edit_specialization").value.trim(),
        cgpa: document.getElementById("edit_cgpa").value.trim(),
        certifications: document.getElementById("edit_certifications").value.trim()
    };

    if (body.cgpa && (isNaN(body.cgpa) || body.cgpa < 0 || body.cgpa > 10)) {
        msg.innerText = "CGPA must be between 0‚Äì10";
        msg.style.color = "red";
        return;
    }

    const res = await fetch("http://127.0.0.1:5000/profile/edit", {
        method: "PATCH",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify(body)
    });

    const data = await res.json();

    if (res.ok) {
        msg.innerText = "Profile updated";
        msg.style.color = "green";
        setTimeout(() => location.reload(), 800);
    } else {
        msg.innerText = data.error || "Update failed";
        msg.style.color = "red";
    }
};

// =======================
// LOGOUT
// =======================
document.getElementById("logoutBtn").onclick = () => {
    localStorage.clear();
    window.location.href = "login.html";
};

// ------------------ JOB PREDICTION ------------------
document.querySelector(".predict-btn").addEventListener("click", async () => {
    console.log("üî• Predict button clicked");
    const token = localStorage.getItem("token");

    const degree = document.getElementById("degree").innerText;
    const specialization = document.getElementById("specialization").innerText;
    const cgpaText = document.getElementById("cgpa").innerText;
    const cgpa = cgpaText === "-" ? null : Number(cgpaText);

    const certText = document.getElementById("certifications").innerText;

    if (degree === "-" || specialization === "-") {
        alert("Please fill education details first");
        return;
    }

    const payload = {
        degree,
        specialization,
        cgpa,
        certifications: certText === "-" ? [] : certText.split(",").map(c => c.trim())
    };

    try {console.log("üî• Sending prediction request", payload);
        console.log("üîë TOKEN:", token);


        const res = await fetch("http://127.0.0.1:5000/predict-job-role", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Prediction failed");
            return;
        }

        renderPrediction(data.all_predictions);
        loadPredictionHistory();

    } catch {
        alert("Prediction server error");
    }
});

function renderPrediction(recommendations) {
    const resultBox = document.getElementById("predictionResult");
    const emptyText = document.getElementById("noPredictionText");

    emptyText.style.display = "none";
    resultBox.style.display = "block";
    resultBox.innerHTML = "<h4>Latest Prediction</h4>";

    recommendations.forEach((rec, index) => {
        resultBox.innerHTML += `
            <div style="margin-bottom:12px;">
                <strong>${index === 0 ? "‚≠ê " : ""}${rec.job_role}</strong>
                <div style="background:#eee;border-radius:6px;">
                    <div style="
                        width:${rec.confidence}%;
                        background:#4caf50;
                        color:white;
                        padding:4px 6px;
                        border-radius:6px;">
                        ${rec.confidence}%
                    </div>
                </div>
            </div>
        `;
    });
} -->
